web:
  restart: always
  build: ./web/
  ports:
    - "80:80"
  expose:
    - "80"
  links:
    - postgres:postgres
    - rabbitmq:rabbitmq
  env_file: env
  volumes:
    - ./web:/app/web
  volumes_from:
    - static
    - media
    - logs
  command: run

postgres:
  restart: always
  build: ./postgres/
  volumes_from:
    - data
  env_file:
    - env
  expose:
    - "5432"

data:
  restart: always
  image: alpine
  volumes:
    - /var/lib/postgresql
  command: "true"

static:
  restart: always
  image: alpine
  volumes:
    - /app/static
  command: "true"

media:
  restart: always
  build: ./media/
  volumes:
    - /app/media
  command: "true"

logs:
  restart: always
  build: ./logs/
  volumes:
    - /app/logs
  command: "true"

rabbitmq:
  restart: always
  image: rabbitmq
  command: ""

celery:
  restart: always
  build: ./celery/
  env_file:
    - env
  links:
    - postgres:postgres
    - rabbitmq:rabbitmq
  volumes_from:
    - web
  command: run

